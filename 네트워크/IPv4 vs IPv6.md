# IPv4 와 IPv6

### 그전에 알아야하는 것들

- 넷마스크, 네트워크 주소, 브로드 캐스트 주소, 게이트웨이,NAT





### 넷마스크

- subnetmask라고도 한다
- 하나의 네트워크를 몇개의 네트워크로 나누어 사용할 때 나눠진 각각의 네트워크를 구분하기 위해 사용되는 특수 bit
- 트래빅 부하를 감소 시킬 수 있음
- 네트워크를 독립된 구성으로 가능하게 함
  - C클래스에 속하는 하나의 네트워크를 n개의 네트워크로 나누었을 때 사용가능한 총 host IP 주소의 개수
    - {256 -(n*2)}개, if n==짝수
  - C클래스에 속하는 하나의 네트워크를 n개의 네트워크로 나누었을 경우 각각 개별 네트워크에서 사용 가능한 호스트 IP의 개수 
    - {(256/n)-2}개, if n==짝수
    - 2를 뺀 이유는 네트워크 주소와 브로드캐스트 주소를 뺀 나머지



### 네트워크 주소 (호스트 식별자가 모두 0)

- 하나의 네트워크를 통칭하기 위해 사용 되는 주소
- C클래스 하나로 특정 네트워크를 구성하려고 할 경우 네트워크 주소가 192.168.1.0 이라고 하면 이 네트워크에 속하는 주소는 192.168.1.0 ~ 192.168.1.255이다
- 네트워크에 속하는 첫주소



### 브로드캐스트(Broad Cast, 호스트 식별자가 모두 1)

- 특정 네트워크에 속하는 모든 호스트 들이 듣게 되는 주소
- C클래스 하나로 특정 네트워크를 구성하였고 네트워크주소가 192.168.2.0 이라고 하면 브로드 캐스트 주소는 192.168.2.255가 됨
- 네트워크에 속하는 마지막 주소



### 게이트웨이

- 서로 다른 네트워크를 연결해주는 역할, 특정 장비나 호스트를 의미!
- 예) 라우터
  - 라우팅 테이블 확인 후 받은 패킷을 적합한 다른 네트워크로 전달해주는 역할 => IP 포워딩, 패킷 포워딩
  - 특정 네트워크 내에서 호스트 주소로 사용되는 IP주소들 가운데 맨 마지막 IP인 254주소를 주로 사용



### IPv4

- IP 계층에서 사용되는 32비트 주소
- 라우터나 호스트의 인터넷 연결을 범용적이고 유일하게 만들어주는 식별자이다.
- A,B,C,D 클래스로 구분
  - A,B,C는 일반 인터넷을 위해 사용, D 클래스는 멀티캐스트 용도, E는 연구개발
- 크게 **네트워크 식별자**와 **호스트 식별자**로 나뉨
- **NAT**(Network Address Translation) : 사설 주소(private)와 범용 주소(public) 의 매핑을 제공하는 동시에 사설 네트워크를 지원하는 기술
- IPv4로 모든 주소를 할당하기에는 주소 부족 현상이 나타나서 IPv6와 NAT가 나타남! + CIDR
  - 주소 부족현상을 해결하기 위해



##### NAT(layer 3)

- 사설 주소(private)와 범용 주소(public) 의 매핑을 제공하는 동시에 사설 네트워크를 지원하는 기술
- 또한, 가상 사설 네트워크를 지원
- 방화벽의 핵심 기술,,,? 이건 왜지
- NAT는 사설 주소의 재사용에 근간한 것으로, 이것을 라우터에 구현
- NAPT라는 것도 있는데 이것은 포트 넘버에 따라 구분하는 방식
  - layer 4
- 라우터는 각 포트에서 데이터를 받아 NAT 매핑 규칙에 따라 IP 패킷의 발신지 IP 주소 필드를 고유한 공인 IP 주소로 변환하여 전송
- 사설 IP 주소 : 일반 가정이나 회사 내 등에 할당 네트워크의 IP 주소
  - 로컬 IP 주소라고도 함
  - 라우터에 의해 로컬 네트워크상의 PC 나 장치에 할당
  - 외부에 공개되지 않아 외부에서의 접근이 기본적으로 불가능
  - 192.168.XX 주로 사용
  - 사설 IP 주소만으로는 인터넷은 직접 연결되지 않는다
  -  라우터 장비에서 **개인 IP 주소** 와**글로벌 IP 주소**를 상호 변환함으로써 인터넷을 이용할 수 있다.
  - 예를 들어, 라우터를 통해 1개의 공인 IP 주소만 할당하고, 리우터에 연결된 개인 PC는 사설 IP 주소(가상 IP 주소) 각각 할당 받아 인터넷에 접속할 수 있다.
- 공용 IP 주소 : 인터넷과 같은 공공 회선에 액세스 할 때 글로벌 IP 주소로 구축된 네트워크
  -  외부에 공개되어 있는 IP 주소
  -  인터넷 사용자의 로컬 네트워크를 식별하기 위해 ISP(인터넷 서비스 공급자)가 제공하는 IP 주소
- 장점
  - IP 주소 고갈 문제를 다소 해결
  - 외부에서 내부 네트워크 정보를 알 수 없음 -> 보안적 측면
- 단점
  - IP 헤더의 IP 주소를 수정하기 때문에 매번 IP 헤더 체크섬을 다시 계산
  - 포트 넘버를 수정하기 때문에 TCP 체크섬 다시계산
  - 라우터를 지나는 모든 패킷에 대해 주소와 포트 넘버를 수정해야해서 딜레이 발생
  - end-to-end 통신 방해
  - 포트 넘버를 바꾸기 위해 network layer에서 transport layter까지 침해한 다는 것
- 유형
  - Static NAT : 내부 네트워크 주소와 외부 네트워크 주소간 일대일 매핑
  - Dynamic NAT : 내부 네트워크 주소 그룹에서 하나의 외부 네트워크 주소를 내부 네트워크 주소와 동적으로 매핑
  - Port NAT : 여러개의 내부 네트워크 주소를 하나 또는 몇 개의 외부 네트워크 주소에 포트번호를 다르게 하여 외부 네트워크와 통신



##### CIDR

- 기존 클래스 기반 주소 할당 방법을 좀 더 유연하게 표기한 것
- Classless Inter-Domain Routing



### IPv6

- 네트워크에 연결된 호스트와 단말이 급증하면서 IP 주소 공간 부족
- 128비트 -> 3.4 X 10<sup>32</sup> 개의 주소 사용 가능
- 효과적인 QoS 서비스 지원
- IPv4에는 보안 기능이 포함되지 않아 **IPsec**보안 프로토콜을 따로 설치해야한다.
- 보안과 개인 보호 기능을 추가하여 종단간 아모화 기능 제공
- 16비트씩 8구간, 16진수
- 포맷 접두사와 주소 필드로 구성
  - 포맷 접두 사 : 주소 형태를 기술
    - ex. NSAP할당을 위해 예약한 주소 (0000 001), 사이트 로컬주소 (1111 110 11)
  - 주소 필드 : 순수한 주소
- 용도에 따라 링크 로컬, 유니캐스트, 멀티캐스트, 애니캐스트 주소로 구분





