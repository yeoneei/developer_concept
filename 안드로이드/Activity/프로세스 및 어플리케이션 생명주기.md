# 프로세스 및 애플리케이션 수명 주기

### Android 프로세스 특징

- Android 앱은 자체 Linux프로세스에서 실행된다. 
- 애플리케이션 프로세스의 수명 주기 전체 기간이 애플리케이션 자체에 의해 직접 제어되지 않는다.
- 수명 주기 전체 기간은 시스템이 실행 중인 것으로 파악하는 애플리케이션 요소, 요소들이 사용자에게 중요한 정도 및 시스템에서 사용할 수 있는 젠체 메모리 양을 조합하여 시스템에 의해 결정된다.
- 앱 구성요소 (activity, service, bradcast receiver)가 프로세스의 수명 주기 전체 기간에 영향을 미치는 방식을 이해하는 것이 중요하다



메모리가 부족 할 때 종료해야 하는 프로세스를 결정하기 위해 Anroid는 프로세스 내에서 실행 중인 구성요소 및 구성요소의 상태에 따라 각 프로세스를 '중요도 계층 구조'에 배치 한다

1. **포그라운드 프로세스** 는 사용자가 현재 하고 있는 작업에 필요한 프로세스
   - 프로세스가 사용자가 상호작용하고 있는 화면 상단에서 `Activity`를 실행 중 (`onResume()` 메서드가 호출)
   - 프로세스에 현재 실행 중인 `BroadcastRecevier`가 존재한다.
   - 프로세스에 콜백(`Service.onCreate()`, `Servcie.onStart()` 또는 `Service.onDestory()`) 중 하나에서 현재 코드를 실행중인 `Service`가 있다.
2. **거시적인 프로세스**는 사용자가 현재 알고있는 작업을 하므로 이 프로세스를 종료하면 사용자 환경에 분명 부정적이 영향을 미친다. 
   - 프로세스가 화면상으로는 사용자에게 표시되지만 포그라운드에 있지 않은 `Activity`를 실행 중 (`onPause()` 메서드가 호출)
   - 프로세스에 `Service.startForeground()`를 통해 포그라운드 서비스로 실행 중인 `Service`가 존재
   - 프로세스가 시스템에서 라이브 배경화면, 입력 방법 서비스 등과 같이 사용자가 알고 있는 특정 기능에 사용하는 서비스를 호스팅 함
   - 시스템에서 실행 중인 프로세스의 수는 포그라운드 프로세스보다 덜 제한적이지만 그럼에도 비교적 관리되는 편이다. 
     - 프로세스의 종료가 모든 포그라운드 프로세스의 실행 상태를 유지하는데 필요한 상황이 아니라면 종료되지 않는다.
3. **서비스 프로세스**는 `startService()`메서드로 시작된 `Service`를 유지하는 프로세스
   - 사용자에게 직접 표시되지 않지만 일반적으로 관심을 가진 작업을 실행
   - 모든 포그라운드 프로세스 및 가시적 프로세스를 유지할 메모리가 부족하지 않으면 이러한 프로세스 실행 형태를 유지
   - 오랫동안(약 30분)실행되고 있는 서비스는 중요도가 강등됨에 따라 프로세스가 캐시된 LRU 목록으로 이전 될 수 있다.
     - 메모리 누출 또는 기타 문제가 있는 장기 실행 서비스가 너무 많은 RAM을 소비하여 시스템이 캐시된 프로세스를 효과적으로 활용하지 못하는 상황을 방지한다.
4. **캐시된 프로세스**는 현재 필요하지 않은 프로세스
   - 언제든 종료 가능
   - 효율적인 애플리케이션 간 전환을 위해 다수의 캐시된 프로세스가 항상 사용가능하며 필요에 따라 가장 오래된 프로세스를 정기적으로 종료한다.
   - 현재 사용자에게 표시되지 않는 하나 이상의 Activity인스턴스를 포함한다.(`onStop()`호출되어 반환됨)
     - 캐시된 프로세스가 활동 수명 주기를 올바르게 구현하면 시스템이 이러한 프로세스를 종료해도 사용자 환경에 영향을 주지 않는다. (이전 상태 복원)
     - 의사 LRU 목록으로 유지되며 회수 시 목록의 마지막 프로세스가 가장 처음으로 종료



프로세스 분류 방법을 결정할 때 시스템은 프로세스에서 현재 활성 상태인 모든 구성요소 중 가장 높은 중요도에 따라 결정을 내린다.

