# 아키텍처 구성요소란

Android 아키텍처 구성요소는 강력하고 테스트와 유지관리가 쉬운 앱을 디자인하도록 돕는 라이브러리 모음

- UI 구성요소의 수명주기 관리
- 데이터 지속성 처리



### 내용

- `LiveData`를 사용하여 기본 데이터베이스가 변경되면 뷰에 알리는 데이터 개치 빌드
- `ViewModel`은 앱 회전 시 제거 되지 않는 UI 관련 데이터 저장
- `Room`은 SQLite 개체 매핑 라이브러리
  - SQLite 테이블 데이터를 자바 개체로 쉽게 변환
  - RxJava, Rlowable, LiveData observable반환



### 모바일 앱 사용자 환경

- Android는 Activity, Fragment, Service, Content Provicder, BroadCast Recevier를 비롯하여 앱 구성요소가 존재
- manifest.xml에 이러한 구성요소 대부분을 선언하며 Android os에서 전반적인 사용자 환경에 앱을 통합하는 방법을 결정
- 여러 구성요소를 포함하며, 사용자는 짧은 시간 내에 여러 앱과 상호작용을 할 때도 많기 때문에 다양한 워크플로우 및 작업에 맞게 조정될 수 있어야한다.
- EX)
  - 앱이 카메라 인텐트를 트리거한다. 그러면 Android OS에서 요청을 처리하기 위해 카메라 앱을 실행한다. 이 시점에 사용자는 소셜 네트워크 앱에서 나간 상황이지만 사용 환경은 끊김 없이 연결 되어야 한다.
  - 카메라 앱은 파일 선택기 실행처럼 다른 인텐트를 트리거하여 다른 앱을 실행할 수도 있다.
  - 이후에 사용자가 다시 소셜 네트워크 앱으로 돌아와서 사진을 공유한다.
  - 얼마든지 알림에 의해 사용자 환경이 중단 될 수 있고 그 후 사진 공유 프로세스로 돌아가 작업을 할 수 있어야한다.

- 이러한 워크 플로우 흐름을 올바르게 처리해야한다.



### 일반 아키텍처의 원리

##### 관심사의 분리

- Activity또는 Fragment에 모든 코드를 작성하는 실수가 일어난다
- 이러한 UI 기반 클래스는 UI 및 운영체제 상호작용을 처리하는 로직만 포함해야한다.
- 최대한 가볍게 유지해야 LifeCycle관련 문제를 피할 수 있다.
- 사용자의 상호작용을 기반으로 메모리 부족과 같은 시스템 조건으로 인해 언제든지 OS가 클래스를 제거 할 수 있다.
- 만스러운 환경과 수월한 앱 관리 환경 제공을 위해 의존성을 최소화 해야한다.



##### 모델에서 UI 만들기

- 가급적 지속적인 모델 권장
- **모델** : 앱의 데이터 처리를 담당하는 구성요소
  - 앱의 `View`객체 및 앱 구성요소와 독립되어 있으므로 LifeCycle 및 관련 문제와 영향 받지 않는다.
- 지속 모델이 이상적인 이유
  - Android OS에서 리소스를 확보하기 위해 앱을 제거해도 사용자 데이터가 삭제되지 않는다.
  - 네트워크 연결이 취약하거나 연결되어 있지 않아도 앱이 계속 작동한다.
- 모델 클래스 기반으로 앱을 만들면 수비게 테스트하고 일관성 유지 가능





##### 권장 앱 아키텍처

- 모든 시나리오에 최적화 된 하나의 앱 작성 방뻐은 없다. 하지만 이 권장 아키텍처는 대부분의 상황 및 워크 프로우에 유용한 출발점이 될 것

- EX) 사용자 프로필 표시하는 UI 제작

  - 비공개 백엔드 및 REST API사용하여 프로필 데이터 가져옴

    ![final-architecture](./img/final-architecture.png)

  - 각 구성요소가 한 수준 아래 구성요소에만 종속됨을 볼 수 있다.

    - Activity 및 프래그먼트는 ViewModel에만 종속된다.
    - 저장소는 여러개의 다른 클래스에 종속되는 유일한 클래스
      - 지속 데이터모델과 원격 백엔드 데이터 소스에 종속



### 사용자 인터페이스 제작

- UI는 프래그먼트 , `UIProfileFragment`, 관련 레이아웃파일(`user_profile_layout.xm`)로 구성된다.
- UI를 만들려면 데이터 모델에 다음 데이터 요소가 있어야 한다.
  - **사용자 ID**: 사용자의 식별자. 프래그먼트 인수를 사용하여 이 정보를 프래그먼트에 전달하는 것이 좋다. Android OS에서 프로세스를 제거해도 이 정보가 유지되므로, 앱을 다시 시작할 때 ID를 사용할 수 있다.
  - **사용자 객체**: 사용자에 관한 세부정보를 보유하는 데이터 클래스
- `ViewModel`아키텍처 구성요소에 기반한 `UserProfileModel`을 사용하여 이 정보 유지
  - `ViewModel` 객체는 프래그먼트나 활동 같은 특정 UI 구성요소에 관한 데이터를 제공하고 모델과 커뮤니케이션하기 위한 데이터 처리 비즈니스 로직을 포함함
    - Ex.) `ViewModel`은 데이터를 로드하기 위해 다른 구성요소를 호출하고 사용자 요청을 전달하여 데이터를 수정할 수 있다. `ViewModel`은 UI 구성요소에 관해 알지 못하므로 구성 변경(예: 기기 회전 시 활동 재생성)의 영향을 받지 않는다.
- **정리**
  - `user_profile.xml` : 화면의 UI레이아웃 저으이
  - `UserProfileFragement` : 데이터를 표시하는 UI 컨트롤러
  - `UserProfileViewModel` : `UserProfileFragment`에서 볼 수 있도록 데이터를 준비하고 사용자 상호 작용하는 클래스